<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="cache-control" content="no-store">
    <link rel="stylesheet" href="default.css"/>
    <title>Bulletproof Showcase</title>
</head>
<body>
<div class="video-selector" id="video-selector">
    <p><b>Select video</b> (optional)</p>
    <button id="enter-video-url-btn" type="button">Enter online video URL</button>
    <span id="local-video-selector-container">
        &nbsp;or&nbsp;
        <button id="select-local-video-btn" type="button">Select local video (NW.js/Electron)</button>
        <input type="file" id="select-local-video" hidden="hidden" multiple="multiple"
               accept=".mp4,.ogv,.flv,video/mp4,video/H264"/>
    </span>
</div>
<div id="test-case-selector-container">
    <p><b>Test Cases</b></p>
    <ol id="test-case-selector">
    </ol>
</div>
<div class="initially-hidden" id="playground">
    <div style="margin-bottom: 10px;">
        <b>Selected:</b>&nbsp;<span id="test-case-desc"></span>&nbsp;
        <button type="button" onclick="reloadPage();">Reload Page</button>
        <span style="margin-left: 10px;">
            FPS:&nbsp;
            <span id="fps-indicator">
            </span>
        </span>
        <div style="margin-top: 5px;">
            <label for="input-danmaku">Add flying danmaku:</label>
            <input id="input-danmaku" name="input-danmaku" type="text" style="width: 120px;"/>
            <button type="button" onclick="addFlyingDanmaku();">Add</button>
        </div>
    </div>
    <div id="glantern-container">
        <div class="absolute black-background" style="width: 682px; height: 438px; z-index: 0;"></div>
    </div>
</div>
<script type="text/javascript" id="bp-source-loader">
    (function loadBulletproofSource(useNodeVersion, useMinimizedVersion, forceNoCache) {
        function defaultValue(obj, value) {
            return typeof obj === "undefined" ? value : obj;
        }

        useNodeVersion = defaultValue(useNodeVersion, false);
        useMinimizedVersion = defaultValue(useMinimizedVersion, false);
        forceNoCache = defaultValue(forceNoCache, true);
        var src = null;
        if (useNodeVersion) {
            src = "../../build/node/index";
            window.Bulletproof = require(src);
        } else {
            src = "../../build/Bulletproof-browser" + (useMinimizedVersion ? ".min" : "") + ".js";
            if (forceNoCache) {
                var timeMillis = Date.now();
                src += "?time=" + timeMillis.toString();
            }
            var newScriptTag = document.createElement("script");
            newScriptTag.type = "text/javascript";
            newScriptTag.src = src;
            var thisScriptTag = document.getElementById("bp-source-loader");
            if (thisScriptTag.nextElementSibling) {
                document.body.insertBefore(newScriptTag, thisScriptTag.nextElementSibling);
            } else {
                document.body.appendChild(newScriptTag);
            }
        }
    })(undefined, true);
</script>
<script type="text/javascript" src="bootstrap.js"></script>
<script type="text/javascript">
    function reloadPage() {
        // Note: Reloading problem
        //   When caching policy is active, Bulletproof fails to redraw in the new session created by
        // clicking "Reload" button. Detailed relation between cached scripts and rendering logic
        // is not analyzed yet, however it is sure that caching does prevent rendering right.
        //   A workaround to the problem is to disable caching. This action is performed by
        // loadBulletproofSource() function. In order to disable caching, please use the plain JavaScript
        // version (useNodeVersion=false) even in NW.js, and force disabling caching (forceNoCache=true).
        // I have tested and discovered that, setting a specific no-caching header in this page
        // (<meta http-equiv="cache-control" content="no-store">) does not work.
        window.location.reload(true);
    }
</script>
</body>
</html>
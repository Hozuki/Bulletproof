{"version":3,"sources":["danmaku/scripted/dco/dcohelper.ts"],"names":["DCOHelper","DCOHelper.constructor","DCOHelper.fillInCreateParams","DCOHelper.fillInCreateParams.___getMaximumLifeTime","DCOHelper.applyGeneralCreateParams","DCOHelper.applyButtonCreateParams"],"mappings":"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","file":"danmaku/scripted/dco/DCOHelper.js","sourcesContent":["/**\r\n * Created by MIC on 2015/12/29.\r\n */\r\n\r\nimport {IGeneralCreateParams} from \"../../../bilibili/danmaku_api/data_types/IGeneralCreateParams\";\r\nimport {IDanmakuCreatedObject} from \"./IDanmakuCreatedObject\";\r\nimport {ICommentButtonCreateParams} from \"../../../bilibili/danmaku_api/data_types/ICommentButtonCreateParams\";\r\nimport {Bulletproof} from \"../../../Bulletproof\";\r\nimport {IMotionPropertyAnimation} from \"../../../bilibili/danmaku_api/data_types/IMotionPropertyAnimation\";\r\nimport {IMotion} from \"../../../bilibili/danmaku_api/data_types/IMotion\";\r\nimport {DisplayObject} from \"../../../../lib/glantern/src/flash/display/DisplayObject\";\r\nimport {GLUtil} from \"../../../../lib/glantern/lib/glantern-utils/src/GLUtil\";\r\n\r\nexport abstract class DCOHelper {\r\n\r\n    static fillInCreateParams(bulletproof:Bulletproof, requestingObject:DisplayObject&IDanmakuCreatedObject, createParams:IGeneralCreateParams):IGeneralCreateParams {\r\n        var r:IGeneralCreateParams = <any>Object.create(null);\r\n\r\n        r.color = createParams.color;\r\n        r.alpha = createParams.alpha;\r\n        r.fontsize = createParams.fontsize;\r\n        r.lifeTime = createParams.lifeTime !== undefined ? createParams.lifeTime : Number.MAX_VALUE;\r\n        r.parent = createParams.parent;\r\n        r.x = createParams.x;\r\n        r.y = createParams.y;\r\n\r\n        function __getMaximumLifeTime(motion:IMotion):{maxLife:number, literalMaxLife:number} {\r\n            var motionAnimation:IMotionPropertyAnimation;\r\n            var propertyNames:string[] = [\"x\", \"y\", \"alpha\", \"rotationZ\", \"rotationY\"];\r\n            var maxLife:number = 0;\r\n            var literalMaxLife:number = 0;\r\n            for (var j = 0; j < propertyNames.length; ++j) {\r\n                motionAnimation = <IMotionPropertyAnimation>(<any>motion)[propertyNames[j]];\r\n                if (!GLUtil.isUndefinedOrNull(motionAnimation)) {\r\n                    if (GLUtil.isUndefinedOrNull(motionAnimation.lifeTime)) {\r\n                        motionAnimation.lifeTime = requestingObject.extraCreateParams.creator.lifeTime;\r\n                    }\r\n                    if (!GLUtil.isUndefinedOrNull(motionAnimation.startDelay)) {\r\n                        maxLife = Math.max(maxLife, motionAnimation.lifeTime * 1000 + motionAnimation.startDelay);\r\n                    } else {\r\n                        maxLife = Math.max(maxLife, motionAnimation.lifeTime * 1000);\r\n                    }\r\n                    literalMaxLife = Math.max(literalMaxLife, motionAnimation.lifeTime * 1000);\r\n                }\r\n            }\r\n            return {\r\n                maxLife: maxLife,\r\n                literalMaxLife: literalMaxLife\r\n            };\r\n        }\r\n\r\n        if (!GLUtil.isUndefinedOrNull(createParams.motion) && !GLUtil.isUndefinedOrNull(createParams.motionGroup)) {\r\n            console.warn(\"'motion' and 'motionGroup' are both set!\");\r\n        }\r\n        var now = bulletproof.timeElapsed;\r\n        var life:{maxLife: number, literalMaxLife: number};\r\n        var motion:IMotion;\r\n        if (!GLUtil.isUndefinedOrNull(createParams.motion)) {\r\n            motion = createParams.motion;\r\n            motion.sourceObject = requestingObject;\r\n            motion.createdTime = now;\r\n            life = __getMaximumLifeTime(motion);\r\n            motion.maximumLifeTime = life.maxLife;\r\n        }\r\n        if (!GLUtil.isUndefinedOrNull(createParams.motionGroup)) {\r\n            for (var i = 0; i < createParams.motionGroup.length; ++i) {\r\n                motion = createParams.motionGroup[i];\r\n                motion.sourceObject = requestingObject;\r\n                motion.createdTime = now;\r\n                life = __getMaximumLifeTime(motion);\r\n                motion.maximumLifeTime = life.maxLife;\r\n                now += life.literalMaxLife;\r\n            }\r\n        }\r\n        // Warning: shallow copy\r\n        r.motion = createParams.motion;\r\n        r.motionGroup = createParams.motionGroup;\r\n\r\n        return r;\r\n    }\r\n\r\n    static applyGeneralCreateParams(displayObject:DisplayObject&IDanmakuCreatedObject, createParams:IGeneralCreateParams):void {\r\n        if (!GLUtil.isUndefinedOrNull(createParams.alpha)) {\r\n            displayObject.alpha = createParams.alpha;\r\n        }\r\n        if (!GLUtil.isUndefinedOrNull(createParams.x)) {\r\n            displayObject.x = createParams.x;\r\n        }\r\n        if (!GLUtil.isUndefinedOrNull(createParams.y)) {\r\n            displayObject.y = createParams.y;\r\n        }\r\n    }\r\n\r\n    static applyButtonCreateParams(displayObject:DisplayObject&IDanmakuCreatedObject, createParams:ICommentButtonCreateParams):void {\r\n        DCOHelper.applyGeneralCreateParams(displayObject, createParams);\r\n    }\r\n\r\n}\r\n"],"sourceRoot":"/source/"}
{"version":3,"sources":["bulletproof.ts"],"names":["Bulletproof","Bulletproof.constructor","Bulletproof.initialize","Bulletproof.startAnimation","Bulletproof.stopAnimation","Bulletproof.dispose","Bulletproof.danmakuCoordinator","Bulletproof.isAnimationRunning","Bulletproof.timeElapsed","Bulletproof.fps","Bulletproof.SIMPLE_DANMAKU_LIFE_TIME","Bulletproof.CODE_DANMAKU_LIFE_TIME","Bulletproof.___updateComponents"],"mappings":"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","file":"Bulletproof.js","sourcesContent":["/**\r\n * Created by MIC on 2015/12/28.\r\n */\r\n\r\nimport {GLantern} from \"../lib/glantern/src/GLantern\";\r\nimport {DanmakuCoordinator} from \"./danmaku/DanmakuCoordinator\";\r\nimport {CodeDanmakuProvider} from \"./danmaku/code/CodeDanmakuProvider\";\r\nimport {DanmakuProviderBase} from \"./danmaku/DanmakuProviderBase\";\r\nimport {NotImplementedError} from \"../lib/glantern/src/_util/NotImplementedError\";\r\n\r\n/**\r\n * The root controller for Bulletproof.\r\n */\r\nexport class Bulletproof extends GLantern {\r\n\r\n    /**\r\n     * Creates a new {@link Bulletproof} instance.\r\n     */\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * Initialize the {@link Bulletproof} instance with default parameters.\r\n     * @param width {Number} Width of stage requested, in pixels.\r\n     * @param height {Number} Height of stage requested, in pixels.\r\n     */\r\n    initialize(width:number, height:number):void {\r\n        if (!this._isInitialized) {\r\n            super.initialize(width, height);\r\n            this.attachUpdateFunction(this.__updateComponents.bind(this));\r\n            var coordinator = new DanmakuCoordinator(this);\r\n            this._coordinator = coordinator;\r\n\r\n            var provider:DanmakuProviderBase;\r\n            provider = new CodeDanmakuProvider(coordinator);\r\n            coordinator.addDanmakuProvider(provider);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Starts the animation loop. Updating and rendering are automatically handled in the loop.\r\n     * By default, {@link startAnimation} uses {@link window.requestAnimationFrame} function and relies\r\n     * on the frame rate adjuster of the browser window.\r\n     */\r\n    startAnimation():void {\r\n        if (!this.isAnimationRunning) {\r\n            this._lastUpdatedTime = Date.now();\r\n        }\r\n        super.startAnimation();\r\n    }\r\n\r\n    /**\r\n     * Stops the animation loop. Internal state is preserved, and the next {@link startAnimation} call resumes\r\n     * from last state.\r\n     */\r\n    stopAnimation():void {\r\n        this.__updateComponents();\r\n        super.stopAnimation();\r\n    }\r\n\r\n    /**\r\n     * Disposes the {@link Bulletproof} instance and release all resources occupied.\r\n     */\r\n    dispose():void {\r\n        this._coordinator.dispose();\r\n        this._coordinator = null;\r\n        super.dispose();\r\n    }\r\n\r\n    /**\r\n     * Gets the {@link DanmakuCoordinator} instance associated with current {@link Bulletproof} instance.\r\n     * @returns {DanmakuCoordinator}\r\n     */\r\n    get danmakuCoordinator():DanmakuCoordinator {\r\n        return this._coordinator;\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean flag indicating whether the animation loop is running.\r\n     * @returns {Boolean}\r\n     */\r\n    get isAnimationRunning():boolean {\r\n        return this._isRunning;\r\n    }\r\n\r\n    /**\r\n     * Gets total time elapsed in handling the animation loop, in milliseconds.\r\n     * @returns {Number}\r\n     */\r\n    get timeElapsed():number {\r\n        return this._totalElapsedTime;\r\n    }\r\n\r\n    /**\r\n     * Gets the average FPS (frame per second) of last second.\r\n     * @returns {Number}\r\n     */\r\n    get fps():number {\r\n        return this._fps;\r\n    }\r\n\r\n    /**\r\n     * Gets the default life time for simple (text-only) danmakus, in seconds.\r\n     * @returns {Number}\r\n     */\r\n    static get SIMPLE_DANMAKU_LIFE_TIME():number {\r\n        // 10 seconds\r\n        return 10;\r\n    }\r\n\r\n    /**\r\n     * Gets the default life time for code danmakus, in seconds.\r\n     * @returns {Number}\r\n     */\r\n    static get CODE_DANMAKU_LIFE_TIME():number {\r\n        return Number.MAX_VALUE;\r\n    }\r\n\r\n    protected __updateComponents():void {\r\n        if (this._lastUpdatedTime > 0) {\r\n            var now = Date.now();\r\n            this._totalElapsedTime += now - this._lastUpdatedTime;\r\n            this._lastUpdatedTime = now;\r\n        }\r\n        ++this._fpsCounter;\r\n        if (this.timeElapsed - this._lastFpsUpdateElapsedTime > 1000) {\r\n            this._fps = this._fpsCounter / (this.timeElapsed - this._lastFpsUpdateElapsedTime) * 1000;\r\n            this._fpsCounter = 0;\r\n            this._lastFpsUpdateElapsedTime = this.timeElapsed;\r\n        }\r\n        this._coordinator.update();\r\n    }\r\n\r\n    protected _lastUpdatedTime:number = -1;\r\n    protected _totalElapsedTime:number = 0;\r\n    protected _fps:number = 0;\r\n    protected _fpsCounter:number = 0;\r\n    protected _lastFpsUpdateElapsedTime:number = 0;\r\n    protected _coordinator:DanmakuCoordinator = null;\r\n\r\n}\r\n"],"sourceRoot":"/source/"}